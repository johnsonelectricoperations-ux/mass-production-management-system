<!-- ì‘ì—…ì¼ì§€ ì‘ì„± í™”ë©´ -->
<div class="worklog-screen" id="worklogScreen">
    <div class="worklog-container">
        <div class="worklog-header">
            <div class="worklog-title">ğŸ“ ì‘ì—…ì¼ì§€ ì‘ì„± (3êµëŒ€ ì‹œê°„í‘œ)</div>
            <button class="worklog-close-btn" onclick="closeWorkLog()">ë‹«ê¸°</button>
        </div>

        <div class="worklog-date-selector">
            <label for="worklogDate">ì‘ì—…ì¼ì:</label>
            <input type="date" id="worklogDate">
        </div>

        <div class="worklog-table-container">
            <table class="worklog-table" id="worklogTable">
                <thead>
                    <tr>
                        <th>ì‹œê°„</th>
                        <th>ì‘ì—…ì</th>
                        <th>TM-No</th>
                        <th>í’ˆëª…</th>
                        <th>ì‹¤ì </th>
                        <th>ë¹„ê°€ë™ì½”ë“œ</th>
                        <th colspan="2">ë¹„ê°€ë™ì‹œê°„</th>
                        <th>ë¹„ê°€ë™ë‚´ì—­</th>
                        <th>íœ´ì‹ê·¼ë¬´</th>
                    </tr>
                    <tr>
                        <th></th>
                        <th></th>
                        <th></th>
                        <th></th>
                        <th></th>
                        <th></th>
                        <th>ì‹œì‘</th>
                        <th>ì¢…ë£Œ</th>
                        <th></th>
                        <th></th>
                    </tr>
                </thead>
                <tbody id="worklogTableBody">
                    <!-- JavaScriptë¡œ ë™ì  ìƒì„± -->
                </tbody>
            </table>
        </div>

        <div class="worklog-buttons">
            <button type="button" class="btn btn-secondary" onclick="closeWorkLog()">ì·¨ì†Œ</button>
            <button type="button" class="btn btn-primary" onclick="saveWorkLog()">ì €ì¥</button>
        </div>
    </div>
</div>

<style>
    /* ì‘ì—…ì¼ì§€ í™”ë©´ */
    .worklog-screen {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.5);
        z-index: 1000;
        overflow-y: auto;
        padding: 20px;
    }

    .worklog-container {
        background: white;
        border-radius: 15px;
        max-width: 1400px;
        margin: 0 auto;
        padding: 30px;
        box-shadow: 0 10px 40px rgba(0, 0, 0, 0.3);
    }

    .worklog-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 20px;
        padding-bottom: 15px;
        border-bottom: 3px solid #667eea;
    }

    .worklog-title {
        font-size: 1.5em;
        font-weight: bold;
        color: #667eea;
    }

    .worklog-close-btn {
        background: #6c757d;
        color: white;
        border: none;
        padding: 10px 20px;
        border-radius: 8px;
        cursor: pointer;
        font-size: 1em;
        transition: all 0.3s;
    }

    .worklog-close-btn:hover {
        background: #5a6268;
    }

    .worklog-date-selector {
        margin-bottom: 20px;
        display: flex;
        align-items: center;
        gap: 15px;
    }

    .worklog-date-selector label {
        font-weight: 600;
        color: #333;
    }

    .worklog-date-selector input[type="date"] {
        padding: 8px 12px;
        border: 2px solid #e0e0e0;
        border-radius: 8px;
        font-size: 1em;
    }

    .worklog-table-container {
        overflow-x: auto;
        margin-bottom: 20px;
        max-height: 600px;
        overflow-y: auto;
    }

    .worklog-table {
        width: 100%;
        border-collapse: collapse;
        font-size: 0.85em;
    }

    .worklog-table th {
        background: #667eea;
        color: white;
        padding: 8px 5px;
        text-align: center;
        font-weight: 600;
        border: 1px solid #5568d3;
        position: sticky;
        top: 0;
        z-index: 10;
        font-size: 0.9em;
    }

    .worklog-table td {
        border: 1px solid #dee2e6;
        padding: 5px;
        text-align: center;
    }

    .worklog-table td.time-cell {
        background: #f8f9fa;
        font-weight: 600;
        color: #495057;
        min-width: 60px;
    }

    .worklog-table td.shift-a {
        background: #fff3cd;
    }

    .worklog-table td.shift-b {
        background: #d1ecf1;
    }

    .worklog-table td.shift-c {
        background: #f8d7da;
    }

    .worklog-table input[type="text"],
    .worklog-table input[type="number"],
    .worklog-table input[type="time"],
    .worklog-table select,
    .worklog-table textarea {
        width: 100%;
        padding: 4px;
        border: 1px solid #ced4da;
        border-radius: 4px;
        font-size: 0.9em;
        box-sizing: border-box;
    }

    .worklog-table textarea {
        min-height: 30px;
        resize: vertical;
    }

    .worklog-table input:focus,
    .worklog-table select:focus,
    .worklog-table textarea:focus {
        outline: none;
        border-color: #667eea;
    }

    .break-check {
        display: flex;
        justify-content: center;
        align-items: center;
    }

    .break-check input[type="checkbox"] {
        width: 16px;
        height: 16px;
        cursor: pointer;
    }

    .worklog-buttons {
        display: flex;
        justify-content: flex-end;
        gap: 15px;
        padding-top: 20px;
        border-top: 2px solid #e0e0e0;
    }

    @media (max-width: 1200px) {
        .worklog-table {
            font-size: 0.75em;
        }
    }

    @media (max-width: 768px) {
        .worklog-container {
            padding: 15px;
        }

        .worklog-table {
            font-size: 0.7em;
        }

        .worklog-buttons {
            flex-direction: column;
        }

        .btn {
            width: 100%;
        }
    }
</style>

<script>
    // ì‘ì—…ì¼ì§€ í…Œì´ë¸” ìƒì„±
    function generateWorkLogTable() {
        const tbody = document.getElementById('worklogTableBody');
        tbody.innerHTML = '';

        // 08ì‹œë¶€í„° ë‹¤ìŒë‚  07ì‹œê¹Œì§€ 24ì‹œê°„
        for (let hour = 8; hour < 32; hour++) {
            const displayHour = hour >= 24 ? hour - 24 : hour;
            const hourStr = displayHour.toString().padStart(2, '0') + ':00';

            // êµëŒ€ êµ¬ë¶„ (Aì¡°: 08-16, Bì¡°: 16-24, Cì¡°: 00-08)
            let shiftClass = '';
            if (hour >= 8 && hour < 16) {
                shiftClass = 'shift-a'; // Aì¡° (ë…¸ë€ìƒ‰)
            } else if (hour >= 16 && hour < 24) {
                shiftClass = 'shift-b'; // Bì¡° (íŒŒë€ìƒ‰)
            } else {
                shiftClass = 'shift-c'; // Cì¡° (ë¹¨ê°„ìƒ‰)
            }

            const row = document.createElement('tr');
            row.innerHTML = `
                <td class="time-cell">${hourStr}</td>
                <td class="${shiftClass}">
                    <input type="text" id="worker_${hour}" placeholder="ì‘ì—…ì">
                </td>
                <td class="${shiftClass}">
                    <input type="text" id="tmNo_${hour}" placeholder="TM-No">
                </td>
                <td class="${shiftClass}">
                    <input type="text" id="product_${hour}" placeholder="í’ˆëª…">
                </td>
                <td class="${shiftClass}">
                    <input type="number" id="qty_${hour}" placeholder="0" min="0">
                </td>
                <td class="${shiftClass}">
                    <select id="downcode_${hour}">
                        <option value="">-</option>
                        <option value="D01">D01-ì„¤ë¹„ê³ ì¥</option>
                        <option value="D02">D02-ìì¬ë¶€ì¡±</option>
                        <option value="D03">D03-ê¸ˆí˜•êµì²´</option>
                        <option value="D04">D04-í’ˆì§ˆê²€ì‚¬</option>
                        <option value="D05">D05-ê¸°íƒ€</option>
                    </select>
                </td>
                <td class="${shiftClass}">
                    <input type="time" id="downstart_${hour}">
                </td>
                <td class="${shiftClass}">
                    <input type="time" id="downend_${hour}">
                </td>
                <td class="${shiftClass}">
                    <textarea id="downdetail_${hour}" placeholder="ë¹„ê°€ë™ë‚´ì—­"></textarea>
                </td>
                <td class="${shiftClass}">
                    <div class="break-check">
                        <input type="checkbox" id="breakwork_${hour}">
                    </div>
                </td>
            `;
            tbody.appendChild(row);
        }
    }

    // ì‘ì—…ì¼ì§€ ì—´ê¸°
    function openWorkLog() {
        // í˜„ì¬ ë‚ ì§œ ì„¤ì •
        const now = new Date();
        const dateStr = now.toISOString().split('T')[0];
        document.getElementById('worklogDate').value = dateStr;

        // í…Œì´ë¸” ìƒì„±
        generateWorkLogTable();

        // í™”ë©´ í‘œì‹œ
        document.getElementById('worklogScreen').style.display = 'block';
    }

    // ì‘ì—…ì¼ì§€ ë‹«ê¸°
    function closeWorkLog() {
        document.getElementById('worklogScreen').style.display = 'none';
    }

    // ì‘ì—…ì¼ì§€ ì €ì¥
    function saveWorkLog() {
        const workDate = document.getElementById('worklogDate').value;
        const workLogData = [];

        // 24ì‹œê°„ ë°ì´í„° ìˆ˜ì§‘
        for (let hour = 8; hour < 32; hour++) {
            const rowData = {
                hour: hour >= 24 ? hour - 24 : hour,
                worker: document.getElementById(`worker_${hour}`).value,
                tmNo: document.getElementById(`tmNo_${hour}`).value,
                product: document.getElementById(`product_${hour}`).value,
                qty: document.getElementById(`qty_${hour}`).value,
                downtimeCode: document.getElementById(`downcode_${hour}`).value,
                downtimeStart: document.getElementById(`downstart_${hour}`).value,
                downtimeEnd: document.getElementById(`downend_${hour}`).value,
                downtimeDetail: document.getElementById(`downdetail_${hour}`).value,
                breakWork: document.getElementById(`breakwork_${hour}`).checked
            };

            // ë°ì´í„°ê°€ ìˆëŠ” í–‰ë§Œ ìˆ˜ì§‘
            if (rowData.worker || rowData.tmNo || rowData.product || rowData.qty) {
                workLogData.push(rowData);
            }
        }

        console.log('ì‘ì—…ì¼ì§€ ë°ì´í„°:', {
            date: workDate,
            process: selectedProcess,
            machine: selectedMachine,
            data: workLogData
        });

        // TODO: Google Apps Scriptë¡œ ë°ì´í„° ì „ì†¡
        // google.script.run
        //     .withSuccessHandler(function(response) {
        //         alert('ì‘ì—…ì¼ì§€ê°€ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤.');
        //         closeWorkLog();
        //     })
        //     .withFailureHandler(function(error) {
        //         alert('ì €ì¥ ì‹¤íŒ¨: ' + error.message);
        //     })
        //     .saveWorkLogData(workDate, selectedProcess, selectedMachine, workLogData);

        alert('ì‘ì—…ì¼ì§€ê°€ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤.\n(ê°œë°œ ì¤‘ - ì‹¤ì œ ì €ì¥ ê¸°ëŠ¥ì€ ì¶”í›„ êµ¬í˜„)');
        closeWorkLog();
    }
</script>
